








# ----------------------- Explanation -----------------------
# Blueprint: 
# - A Blueprint in Flask is like a "mini-app" inside your main app.
# - It allows you to organize routes separately and then register them in the main app.
#
# render_template:
# - This function loads and renders an HTML template from the "templates" folder.
#
# flash:
# - This function allows you to display temporary messages (like alerts).
# - Requires a secret key to be set in Flask (not used yet in this file).
# ----------------------------------------------------------

# Create a Blueprint named "main"
# - "main" is the name of the Blueprint (used for identification).
# - __name__ represents the name of the current Python module (routes.py).
main = Blueprint("main", __name__)

# ----------------------- ROUTES -----------------------

ok so these are the steps i need for now:
Recommended Order for You
âœ… (Step 1) Connect MongoDB to Flask
âœ… (Step 2) Set up user data storage (models.py)
âœ… (Step 3) Implement and test Signup
âœ… (Step 4) Implement and test Login
âœ… (Step 5) Implement current_user session tracking



APP PASSWORD: Flask-Mail, naiegqcffeghuhim
set MAIL_PASSWORD=naiegqcffeghuhim


ğŸ”¹ What We'll Do in Step 4 (Login)
1ï¸âƒ£ Modify routes.py to implement user login
2ï¸âƒ£ Modify login.html to handle login form submission
3ï¸âƒ£ Store user session after successful login (current_user)
4ï¸âƒ£ Redirect users after logging in
5ï¸âƒ£ Test and fix issues

4ï¸âƒ£ Testing & Fixing Issues
âœ… Test Cases
1ï¸âƒ£ Try accessing /dashboard without logging in â†’ Should redirect to login page.
2ï¸âƒ£ Log in with correct credentials â†’ Should redirect to dashboard and show username.
3ï¸âƒ£ Log in with wrong credentials â†’ Should show Invalid email or password.
4ï¸âƒ£ Refresh dashboard â†’ Should still show username (session persists).
5ï¸âƒ£ Open a new tab â†’ Should still recognize logged-in user.
6ï¸âƒ£ Click Log Out â†’ Should redirect to login page.
7ï¸âƒ£ After logging out, try accessing /dashboard again â†’ Should redirect to login page.




@main.route('/login', methods=['GET', 'POST'])
def login():
    if request.method == 'POST':
        email = request.form.get('email')
        password = request.form.get('password')

        # ğŸ”¹ Find user by email
        user = mongo.db.users.find_one({"email": email})

        # ğŸ”¹ Check if user exists & verify password
        if user and check_password_hash(user["password_hashed"], password):
            # âœ… Create a User instance
            user_obj = User(user_id=str(user["_id"]), username=user["username"], email=user["email"])

            # âœ… Log in the user (Flask-Login handles session)
            login_user(user_obj)

            flash(f"Welcome, {user['username']}!", "success")
            return redirect(url_for('main.dashboard'))  # ğŸš€ Redirect after login
        else:
            flash("Invalid email or password.", "error")

    return render_template('login.html')